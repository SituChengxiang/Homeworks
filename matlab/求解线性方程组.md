# 第三章 线性方程组的数值解法

## 1. 应用背景

线性方程组 $A\mathbf{x} = \mathbf{b}$ 广泛出现在：

- 电路网络分析
- 最小二乘拟合
- 非线性方程组的线性化
- 常/偏微分方程的差分或有限元离散

## 2. 系数矩阵类型

- **低阶稠密矩阵**：阶数 $n \lesssim 150$，非零元密集
- **大型稀疏矩阵**：阶数高，零元素占绝大多数

## 3. 两类主要解法

| 方法 | 特点 | 适用场景 |
|------|------|--------|
| **直接法** | 有限步内得精确解（无舍入误差时）；实际为近似解 | 低阶稠密矩阵 |
| **迭代法** | 逐步逼近解；存贮少、编程简单；需考虑收敛性 | 大型稀疏矩阵 |

## 4. 理论基础（等价命题）

对 $A \in \mathbb{R}^{n \times n} $，以下等价：

1. $A\mathbf{x} = \mathbf{b}$ 对任意 $\mathbf{b}$ 有唯一解  
2. $A$ 非奇异（可逆）  
3. $A\mathbf{x} = \mathbf{0}$ 只有零解  
4. $\det(A) \ne 0$

---

## Gauss 消去法

### 1. 基本思想

通过**行初等变换**将 $A\mathbf{x} = \mathbf{b}$ 化为上三角方程组，再**回代**求解。

三种初等行变换：

- 交换两行（交换变换）
- 某行乘非零常数（比例变换）
- 某行加上另一行的倍数（置换变换）

### 2. 消元过程（以第 $k$ 步为例）

设当前矩阵为 $A^{(k)}$，主元为 $a_{kk}^{(k)} \ne 0$，定义乘子：
$$
l_{ik} = \frac{a_{ik}^{(k)}}{a_{kk}^{(k)}}, \quad i = k+1, \dots, n
$$
更新：
$$
a_{ij}^{(k+1)} = a_{ij}^{(k)} - l_{ik} a_{kj}^{(k)}, \quad j = k, \dots, n \\
b_i^{(k+1)} = b_i^{(k)} - l_{ik} b_k^{(k)}
$$

### 3. 回代公式

对上三角系统 $A^{(n)} \mathbf{x} = \mathbf{b}^{(n)}$：
$$
x_n = \frac{b_n^{(n)}}{a_{nn}^{(n)}}, \quad
x_i = \frac{1}{a_{ii}^{(i)}} \left( b_i^{(i)} - \sum_{j=i+1}^n a_{ij}^{(i)} x_j \right), \quad i = n-1, \dots, 1
$$

### 4. 计算量分析

- **消元**：约 $\frac{n^3}{3}$ 次浮点运算
- **回代**：约 $\frac{n^2}{2}$ 次
- **总计**：$\frac{n^3}{3} + \mathcal{O}(n^2) \approx \mathcal{O}(n^3)$

> 对比：Cramer 法则需 $\mathcal{O}(n! \cdot n)$，完全不可行。

### 5. 问题与改进

#### (1) 主元为零

若 $a_{kk}^{(k)} = 0$，但下方有非零元 → **行交换**

#### (2) 小主元导致误差放大

**例**（教材例1）：
$$
\begin{cases}
0.00300 x_1 + 5.00 x_2 = 5.29 \\
0.470 x_1 - 6.31 x_2 = -3.10
\end{cases}
\quad \text{精确解：} x_1 = 10.0,\ x_2 = 1.00
$$

- **不选主元**（三位有效数字）：$ x_1 = -10.0,\ x_2 = 1.01 $ ❌
- **列主元法**：正确解 ✅

#### (3) 列主元 Gauss 消去法

第 $k$ 步：在第 $k$ 列从第 $k$ 行往下找
$$
p = \arg\max_{k \le i \le n} |a_{ik}^{(k)}|
$$
交换第 $k$ 行与第 $p$ 行，再消元。

#### (4) 行标度化（比例偏序选主元）

为避免大系数行“掩盖”小系数行，先对每行归一化：
$$
s_i = \max_{1 \le j \le n} |a_{ij}|, \quad \text{选主元时比较 } \frac{|a_{ik}|}{s_i}
$$

## 6. MATLAB 实现示例（列主元）

```matlab
function X = uptrbk(A, B)
    [N, ~] = size(A);
    Aug = [A B];
    for p = 1:N-1
        % 列主元
        [~, j] = max(abs(Aug(p:N, p)));
        j = j + p - 1;
        if j ~= p
            Aug([p, j], :) = Aug([j, p], :); % 行交换
        end
        if Aug(p, p) == 0
            error('A is singular.');
        end
        % 消元
        for k = p+1:N
            m = Aug(k, p) / Aug(p, p);
            Aug(k, p:end) = Aug(k, p:end) - m * Aug(p, p:end);
        end
    end
    % 回代
    X = backsub(Aug(:,1:N), Aug(:,end));
end

function X = backsub(U, B)
    n = length(B);
    X = zeros(n,1);
    X(n) = B(n) / U(n,n);
    for k = n-1:-1:1
        X(k) = (B(k) - U(k,k+1:n) * X(k+1:n)) / U(k,k);
    end
end
```

---

## 矩阵分解在解线性方程组中的作用

### 1. LU 分解（Doolittle 分解）

若 $A = LU$，其中：

- $L$：单位下三角矩阵（对角线为1）
- $U$：上三角矩阵

则解 $A\mathbf{x} = \mathbf{b}$ 转化为：

1. 解 $L\mathbf{y} = \mathbf{b}$（前向替换）
2. 解 $U\mathbf{x} = \mathbf{y}$（回代）

### 2. 带行交换的 LU 分解（PA = LU）

若 $A$ 非奇异，则存在置换矩阵 $P$ 使得：
$$
PA = LU
$$
求解步骤：

1. 计算 $[L, U, P] = \text{lu}(A)$
2. $\mathbf{b}_1 = P\mathbf{b}$
3. 前向替换：$L\mathbf{y} = \mathbf{b}_1$
4. 回代：$U\mathbf{x} = \mathbf{y}$

### 3. 例子（教材）

$$
A = \begin{bmatrix}
4 & 3 & -1 \\
2 & 4 & -5 \\
1 & 2 & 6
\end{bmatrix}
\Rightarrow
L = \begin{bmatrix}
1 & 0 & 0 \\
0.5 & 1 & 0 \\
0.25 & 0.5 & 1
\end{bmatrix},\quad
U = \begin{bmatrix}
4 & 3 & -1 \\
0 & 2.5 & -4.5 \\
0 & 0 & 8.5
\end{bmatrix}
$$



### 4. MATLAB 调用及教学实现

内置调用（简洁用法）：

```matlab
A = [1 2 6; 4 8 -1; -2 3 5];
B = [1; 2; 3];
[L, U, P] = lu(A);      % MATLAB 返回 P, L, U 满足 P*A = L*U
Y = L \ (P * B);       % 前向替换
X = U \ Y;             % 回代
```

注：直接使用 `X = A \ B` 是 MATLAB 的推荐用法（它会根据 A 的性质自动选择 LU/Cholesky/QR/SVD 等最合适的方法）。

教学实现（带部分主元的 LU，生成 P, L, U）：

```matlab
function [L, U, P] = lu_pp(A)
    % LU_PP 简洁教学实现：带部分主元的高斯消去（PA = LU）
    n = size(A,1);
    if size(A,2) ~= n
        error('A must be square');
    end
    P = eye(n);
    L = zeros(n);
    U = A;
    for k = 1:n-1
        % 选择该列中从 k 行开始的最大主元
        [~, pivot] = max(abs(U(k:n,k)));
        pivot = pivot + k - 1;
        if abs(U(pivot,k)) < eps
            error('Matrix is (numerically) singular or nearly singular');
        end
        if pivot ~= k
            % 交换行：U, P，同时 L 中已填入部分需同步交换
            U([k pivot], :) = U([pivot k], :);
            P([k pivot], :) = P([pivot k], :);
            if k > 1
                L([k pivot],1:k-1) = L([pivot k],1:k-1);
            end
        end
        % 消去并记录乘子
        for i = k+1:n
            L(i,k) = U(i,k) / U(k,k);
            U(i,k:n) = U(i,k:n) - L(i,k) * U(k,k:n);
        end
    end
    L = L + eye(n); % 补上单位对角
end
```

用法示例：

```matlab
[L,U,P] = lu_pp(A);
X = U \ (L \ (P * B));
```

数值要点与检测：

- 主元选择（部分主元）可以避免除以很小的数，通常在工程中已足够稳健；完全主元在数值上更稳但代价大。 
- 使用 `cond(A)` 或 `rcond(A)` 来判断矩阵是否病态（cond 很大或 rcond 很小则需警惕）。
- 若 A 为对称正定，优先使用 `chol`（Cholesky），它更快且数值稳定：

```matlab
R = chol(A);    % 若 A 非正定将报错
```

- 对称但非定的矩阵可用带枢轴的 LDL 分解：`[L,D,P] = ldl(A)`。

性能与工程实践：

- 生产环境请使用 MATLAB 内置 `lu`（调用 LAPACK）或稀疏求解器（`lu` 的稀疏分支或 SuiteSparse/UMFPACK）。
- 对稀疏矩阵，先重排以减少填充（如 `p = amd(A)`），再调用稀疏 LU：

```matlab
p = amd(A);
[L,U,P,Q,R] = lu(A(p,p));   % 示例，实际返回值视稀疏结构而定
```

---

## 线性方程组迭代解法

> 注：原文此处标为 §3.4，但内容为迭代法，按逻辑归入 §3.3。

### 1. 迭代解法的基本思想

将 $A\mathbf{x} = \mathbf{b}$ 改写为：
$$
\mathbf{x} = B\mathbf{x} + \mathbf{g}
$$
构造迭代格式：
$$
\mathbf{x}^{(k+1)} = B\mathbf{x}^{(k)} + \mathbf{g}
$$
若 $\{\mathbf{x}^{(k)}\}$ 收敛，则极限为解。

### 2. Jacobi 迭代法

将 $A = D - L - U$（$D$ 对角，$L$ 下三角，$U$ 上三角），则：
$$
\mathbf{x}^{(k+1)} = D^{-1}(L + U)\mathbf{x}^{(k)} + D^{-1}\mathbf{b}
$$

**分量形式**：
$$
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j \ne i} a_{ij} x_j^{(k)} \right)
$$

**例子**：
$$
\begin{cases}
4x - y + z = 7 \\
4x - 8y + z = -21 \\
-2x + y + 5z = 15
\end{cases}
\Rightarrow
\begin{aligned}
x^{(k+1)} &= \frac{7 + y^{(k)} - z^{(k)}}{4} \\
y^{(k+1)} &= \frac{21 + 4x^{(k)} + z^{(k)}}{8} \\
z^{(k+1)} &= \frac{15 + 2x^{(k)} - y^{(k)}}{5}
\end{aligned}
$$

### 3. Gauss-Seidel 迭代法

**改进**：计算 $x_i^{(k+1)}$ 时，立即使用已更新的 $x_1^{(k+1)}, \dots, x_{i-1}^{(k+1)}$

**分量形式**：
$$
x_i^{(k+1)} = \frac{1}{a_{ii}} \left( b_i - \sum_{j=1}^{i-1} a_{ij} x_j^{(k+1)} - \sum_{j=i+1}^{n} a_{ij} x_j^{(k)} \right)
$$

通常比 Jacobi 收敛更快。

## 4. 收敛条件：严格对角占优

若对所有 $i$：
$$
|a_{ii}| > \sum_{j \ne i} |a_{ij}|
$$
则 Jacobi 和 Gauss-Seidel 均收敛。

### 5. 范数与误差分析（补充）

#### 向量范数

- 1-范数：$\|\mathbf{x}\|_1 = \sum |x_i|$
- 2-范数（欧氏）：$\|\mathbf{x}\|_2 = \sqrt{\sum x_i^2}$
- ∞-范数：$\|\mathbf{x}\|_\infty = \max |x_i|$

#### 矩阵范数（诱导范数）

- $\|A\|_1 = \max_j \sum_i |a_{ij}|$（最大列和）
- $\|A\|_\infty = \max_i \sum_j |a_{ij}|$（最大行和）
- $\|A\|_2 = \sigma_{\max}(A)$（最大奇异值）

MATLAB 中：`norm(A,1)`, `norm(A,inf)`, `norm(A,2)`

---

## 总结对比表

| 方法 | 类型 | 优点 | 缺点 | 适用 |
|------|------|------|------|------|
| Gauss 消去 | 直接法 | 精确（无舍入时） | $\mathcal{O}(n^3)$，存贮大 | 低阶稠密 |
| LU 分解 | 直接法 | 可重复解多右端 | 需分解 | 同上 |
| Jacobi | 迭代 | 简单，并行性好 | 收敛慢 | 严格对角占优 |
| Gauss-Seidel | 迭代 | 比 Jacobi 快 | 串行 | 同上 |
