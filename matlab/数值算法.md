# 数值计算基础

> Qwen: 本笔记基于《数值计算预备知识》PDF内容，结合 MATLAB 实践视角，系统梳理数值计算的核心概念、误差分析、常用算法及注意事项，并附以典型示例。

---

## 一、数值计算的特点与内容

### 特点

1. **实用性**：与计算机应用紧密结合；
2. **问题类型**：处理连续与离散变量问题，关注**数值结果**；
3. **学科地位**：近代数学的重要分支，研究数学问题的**数值解法**；
4. **思维方法**：以**归纳法**为主，核心问题是**误差**。

### 主要内容

- 误差分析
- 非线性方程数值解法
- 线性方程组数值解法
- 数值积分与微分
- 函数逼近、插值与拟合
- 常微分方程数值解法
- 最小二乘法
- 矩阵特征值问题
- 矩阵分解

---

## 二、算法与复杂度

### 算法定义

从已知量出发，经**有限次四则运算**及规定顺序，求出未知量数值解的完整步骤。

### 评价标准

- **时间复杂度**：所需四则运算（尤其乘除）总次数；
- **空间复杂度**：程序运行所需存储量。

### 示例：计算 $x^{255}$

- **朴素算法**：$x^{255} = x \cdot x \cdots x$（254 次乘法）
- **快速幂算法**：
  $$
  x^{255} = x \cdot x^2 \cdot x^4 \cdot x^8 \cdot x^{16} \cdot x^{32} \cdot x^{64} \cdot x^{128}
  $$
  仅需 **14 次乘法**。

### Horner 算法（多项式求值优化）

对 $n$ 次多项式：
$$
P_n(x) = a_n x^n + a_{n-1} x^{n-1} + \cdots + a_1 x + a_0
$$
可改写为嵌套形式：
$$
P_n(x) = (\cdots((a_n x + a_{n-1})x + a_{n-2})x + \cdots)x + a_0
$$

- **计算量**：$n$ 次乘法 + $n$ 次加法；
- **存储量**：$n+3$ 个单元；
- **优势**：显著优于直接计算（需 $2n-1$ 次乘法）。

---

## 三、误差分析

### 误差来源

| 类型 | 定义 | 示例 |
|------|------|------|
| **模型误差** | 数学模型和实际问题之间的差异 | 忽略空气阻力的自由落体模型 |
| **观测误差** | 参数测量引入 | 用尺子测长度的误差 |
| **截断误差** | 数值方法和精确解 | 泰勒展开截断 |
| **舍入误差** | 计算机有限字长 | 浮点数表示误差 |

---

### 1. 截断误差（Truncation Error）

由近似方法（如级数截断）引起。

#### 示例：$e^{-1}$ 的近似

$$
e^{-1} \approx 1 - 1 + \frac{1}{2!} = 0.5
$$
截断误差（余项）：
$$
R_2 = \frac{e^{-\theta}}{3!},\quad 0 < \theta < 1 \Rightarrow |R_2| < \frac{1}{6} \approx 1.7 \times 10^{-1}
$$

#### 示例：复合近似

$$
e^h + \sin h \approx 1 + h + \frac{h^2}{2} + h - \frac{h^3}{6} = 1 + 2h + \frac{h^2}{2} - \frac{h^3}{6}
$$
其截断误差为 $\mathcal{O}(h^3)$。

---

### 2. 舍入误差（Round-off Error）

计算机用有限位表示实数，导致精度损失。

#### 浮点数表示

实数 $x$ 的规格化十进制浮点形式：
$$
x = \pm 0.a_1 a_2 \cdots a_k \cdots \times 10^c,\quad a_1 \ne 0
$$

- **尾数**：$0.a_1 a_2 \cdots$
- **阶码**：$c$

#### 机器数系 $F(\beta, k, L, U)$

- $\beta$：基数（2, 10, 16）
- $k$：字长（有效位数）
- $L, U$：阶码范围

**示例**：在 $F(10, 4, -33, 33)$ 中，

- $\pi = 3.1415926\cdots$
- 截断：$\text{fl}(\pi) = 0.3141 \times 10^1$
- 四舍五入：$\text{fl}(\pi) = 0.3142 \times 10^1$

#### 舍入误差放大示例

考虑线性方程组：
$$
\begin{bmatrix}
1 & \frac{1}{2} & \frac{1}{3} \\
\frac{1}{2} & \frac{1}{3} & \frac{1}{4} \\
\frac{1}{3} & \frac{1}{4} & \frac{1}{5}
\end{bmatrix}
\begin{bmatrix}
x_1 \\ x_2 \\ x_3
\end{bmatrix}
=
\begin{bmatrix}
\frac{11}{6} \\ \frac{13}{12} \\ \frac{47}{60}
\end{bmatrix}
\quad \Rightarrow \quad x_1 = x_2 = x_3 = 1
$$
若系数舍入为三位小数：
$$
\begin{bmatrix}
1.00 & 0.500 & 0.333 \\
0.500 & 0.333 & 0.250 \\
0.333 & 0.250 & 0.200
\end{bmatrix}
\mathbf{x} =
\begin{bmatrix}
1.83 \\ 1.08 \\ 0.783
\end{bmatrix}
\quad \Rightarrow \quad x_1 \approx 1.09,\ x_2 \approx 0.488,\ x_3 \approx 1.49
$$
**结论**：微小舍入误差可导致解严重失真。

---

### 3. 绝对误差与相对误差

设 $a$ 为精确值，$x$ 为近似值：

- **绝对误差**：$e = a - x$
- **相对误差**：$e_r = \frac{a - x}{a}$

**误差限**：

- 绝对误差限：$|e| \leq \delta$
- 相对误差限：$|e_r| \leq \delta_r$

#### 有效数字

若近似值 $x = \pm 0.a_1 a_2 \cdots a_n \times 10^p$ 的绝对误差不超过第 $n$ 位的半个单位，则称 $x$ 有 **$n$ 位有效数字**。

**示例**：$\sqrt{3} \approx 1.7320508\cdots$

- $x_1 = 1.73$：$|e| \approx 0.002 < 0.5 \times 10^{-2}$ → **3 位有效数字**
- $x_2 = 1.7321$：$|e| \approx 0.00005 < 0.5 \times 10^{-4}$ → **5 位有效数字**
- $x_3 = 1.7320$：$|e| \approx 0.00005 < 0.5 \times 10^{-3}$ → **4 位有效数字**

---

### 4. 误差传播（数值运算误差估计）

设 $u = f(x, y)$，$x, y$ 有误差 $e_x, e_y$，则：

- **绝对误差**：
  $$
  e_u \approx \left| \frac{\partial f}{\partial x} \right| e_x + \left| \frac{\partial f}{\partial y} \right| e_y
  $$

- **相对误差**：
  $$
  e_{r,u} \approx \left| \frac{x}{u} \frac{\partial f}{\partial x} \right| e_{r,x} + \left| \frac{y}{u} \frac{\partial f}{\partial y} \right| e_{r,y}
  $$

#### 基本运算误差公式

| 运算 | 绝对误差 | 相对误差 |
|------|----------|----------|
| $x \pm y$ | $e_x + e_y$ | $\dfrac{\left\| x \right\| e_{r,x} + \left\| y \right\| e_{r,y}}{\left\| x \pm y \right\|}$ |
| $xy$ | $\left\| y \right\| e_x + \left\| x \right\| e_y$ | $e_{r,x} + e_{r,y}$ |
| $x/y$ | $\dfrac{\left\| e_x \right\|}{\left\| y \right\|} + \dfrac{\left\| x e_y \right\|}{\left\| y \right\|^2}$ | $e_{r,x} + e_{r,y}$ |

---

## 四、数值计算中的注意事项

### 1. 避免相近数相减（损失有效数字）

**示例 1**：当 $x$ 很大时，计算 $\sqrt{x+1} - \sqrt{x}$

- **问题**：两相近大数相减
- **改进**：
  $$
  \sqrt{x+1} - \sqrt{x} = \frac{1}{\sqrt{x+1} + \sqrt{x}}
  $$

**示例 2**：当 $x \to 0$ 时，计算 $\frac{1 - \cos x}{\sin x}$

- **问题**：分子 $1 - \cos x \approx 0$
- **改进**：
  $$
  \frac{1 - \cos x}{\sin x} = \frac{1-\cos^2x}{\sin x (1+\cos x)} = \frac{\sin x}{1 + \cos x}
  $$

---

### 2. 防止“大数吃小数”

**示例**：在 5 位浮点系统 $F(10,5,-119,119)$ 中计算
$$
23456 + 0.2 + 0.4 + 0.4
$$

- **错误顺序**：$23456 + 0.2 = 23456$（小数被“吃掉”）
- **正确做法**：先加小数 $0.2 + 0.4 + 0.4 = 1.0$，再加 $23456 + 1 = 23457$
- P.S 现在基本上已经没有这个问题了

---

### 3. 避免除数接近零

**示例**：计算 $\frac{1}{y}$，若 $y \approx 0$，可能导致溢出。

- **对策**：代数化简或使用极限分析。

比如 $$y=\frac{1}{\sqrt{1e20+1}-\sqrt{1e20}}=Inf \text{数据下溢}\implies y=\sqrt{1e20+1}+\sqrt{1e20}=\mathrm{2.000000000000000e+10}$$

---

### 4. 简化计算步骤，减少运算次数

**示例**：矩阵连乘 $E = ABCD$，其中

- $A: 10 \times 20$
- $B: 20 \times 50$
- $C: 50 \times 1$
- $D: 1 \times 100$

不同结合方式计算量：

- $((AB)C)D$：$10 \cdot 20 \cdot 50 + 10 \cdot 50 \cdot 1 + 10 \cdot 1 \cdot 100 = 11500$
- $(A(BC))D$：$20 \cdot 50 \cdot 1 + 10 \cdot 20 \cdot 1 + 10 \cdot 1 \cdot 100 = 2200$ ✅ 最优

---

## 五、算法的数值稳定性

### 定义

- **数值稳定**：输入有扰动，计算中舍入误差**不增长**；
- **数值不稳定**：舍入误差**迅速放大**。

### 示例：积分递推

计算
$$
y_n = \int_0^1 \frac{x^n}{x+5} dx,\quad n = 0,1,\dots,8
$$
有递推关系：
$$
y_n = \frac{1}{n} - 5 y_{n-1}
$$

- **向前递推**（$y_0 \to y_8$）：误差放大 $5^n$ 倍 → **不稳定**
- **向后递推**（$y_8 \approx 0.019 \to y_0$）：误差缩小 $1/5^n$ 倍 → **稳定**

$$
\because 0<y_n<y_{n-1}\Rightarrow5y_{n-1}<y_n+5y_{n-1}<6y_{n-1} \\ y_8\approx\frac{1}{2}(\frac{1}{6\times9}+\frac{1}{5\times9})\approx0.019
\frac{1}{6n}<y_{n-1}<\frac{1}{5n}$$

两种算法的稳定不行不同

### 无条件稳定和条件稳定的一个例子：求解二次方程组

- 对任何输入数据都是稳定的算法称为无条件稳定。
- 对某些数据稳定，而对另一些数据不稳定的算法称为条件稳定。

求二次方程 $ax^2+bx+c=0$ 的根。  

方法1： 利用公式 $x_{1,2}=\frac{-b\pm\sqrt{b^2-4ac}}{2a}$  
在 $b\gg 4ac$ 时此算解法不稳定  

方法2： $x_1=\dfrac{-b-\operatorname{sign}(b) \sqrt{b^2-4ac}}{2a}, x_2=\frac{c}{a x_1}$ 此解法无条件稳定（$\operatorname{sign}$为符号函数（sign function）是一种数学函数，用于提取数值的符号，其返回值为1、0或-1，分别表示正数、零和负数。）

---

## 六、二进制与数制转换（简要）

- **十进制 → 二进制（整数）**：除 2 取余，倒排
  - $30_{10} = 11110_2$
- **十进制 → 二进制（小数）**：乘 2 取整
  - $0.6875_{10} = 0.1011_2$
- **二进制 ↔ 八/十六进制**：每 3/4 位一组转换

---

## 七、MATLAB 中的数值计算实践要点

- 使用 `format long` 查看高精度结果；
- 避免直接比较浮点数相等，应使用容差：

  ```matlab
  tol = 1e-12;
  if abs(a - b) < tol
      % a ≈ b
  end
  ```

- 利用向量化操作减少循环，提高效率；
- 对病态问题（如高条件数矩阵），考虑正则化或高精度算法。

---

## 八、非线性方程求根

求解形如 $f(x)=0$ 的方程根的数值方法。

### 1. 不动点迭代法 (Fixed-Point Iteration)

#### 基本思想

将方程 $f(x)=0$ 转化为等价的不动点形式：
$$
x = \phi(x)
$$
若 $x^*$ 是 $f(x)$ 的根，则 $x^*$ 也是 $\phi(x)$ 的**不动点**。

通过迭代序列 $x_{k+1} = \phi(x_k)$ 来逼近不动点 $x^*$。从一个初始猜测值 $x_0$ 开始，反复应用迭代公式，直到序列收敛。

#### 收敛条件（压缩映射定理）

不动点迭代法不是总能收敛。其收敛性取决于函数 $\phi(x)$ 的性质。

**局部收敛定理**：若 $x^*$ 是 $\phi(x)$ 的不动点，且在包含 $x^*$ 的某个邻域内，$\phi(x)$ 可导且满足：
$$
|\phi'(x^*)| < 1
$$
则存在一个包含 $x^*$ 的足够小的区间，对于任意初值 $x_0$ 在该区间内，迭代序列 $x_{k+1} = \phi(x_k)$ 均收敛到 $x^*$。

- **几何意义**：在不动点附近，函数 $\phi(x)$ 的斜率绝对值必须小于 1，即 $\phi(x)$ 是一个**压缩映射**。
- **收敛速度**：$|\phi'(x^*)|$ 的值越小，收敛速度越快。若 $|\phi'(x^*)|=0$，则为**超线性收敛**（至少二阶）。

#### 迭代格式的构造

同一个方程 $f(x)=0$ 可以构造出多种不同的不动点迭代格式 $x=\phi(x)$，但并非所有格式都收敛。

**示例**：求解 $f(x) = x^2 - x - 2 = 0$（根为 $x^*=2$ 和 $x^*=-1$）。

1.  **格式一**：$x = x^2 - 2 \implies \phi_1(x) = x^2 - 2$
    - $\phi_1'(x) = 2x$
    - 在根 $x^*=2$ 附近，$\phi_1'(2) = 4 > 1$，迭代**发散**。

2.  **格式二**：$x = \sqrt{x+2} \implies \phi_2(x) = \sqrt{x+2}$
    - $\phi_2'(x) = \frac{1}{2\sqrt{x+2}}$
    - 在根 $x^*=2$ 附近，$\phi_2'(2) = \frac{1}{4} < 1$，迭代**收敛**。

3.  **格式三**：$x = 1 + \frac{2}{x} \implies \phi_3(x) = 1 + \frac{2}{x}$
    - $\phi_3'(x) = -\frac{2}{x^2}$
    - 在根 $x^*=2$ 附近，$|\phi_3'(2)| = |-\frac{2}{4}| = \frac{1}{2} < 1$，迭代**收敛**。

**结论**：构造一个收敛的迭代格式是应用不动点法的关键。

#### MATLAB 示例：求解 $x = \cos(x)$

```matlab
function fixed_point_example
    % 求解 x = cos(x) 的不动点
    phi = @(x) cos(x);

    x0 = 0.5;         % 初始猜测值
    tol = 1e-8;       % 容差
    maxIter = 100;    % 最大迭代次数

    fprintf('k\t x_k\t\t |x_k - x_{k-1}|\n');
    fprintf('---\t --------\t --------------\n');

    x_prev = x0;
    for k = 1:maxIter
        x_curr = phi(x_prev);
        err = abs(x_curr - x_prev);

        fprintf('%d\t %.8f\t %.2e\n', k, x_curr, err);

        if err < tol
            break;
        end

        x_prev = x_curr;
    end

    fprintf('\n方程 x = cos(x) 的近似解为: %.8f\n', x_curr);
end
```
在这个例子中，$\phi(x) = \cos(x)$，其导数 $\phi'(x) = -\sin(x)$。因为对所有 $x$ 都有 $|-\sin(x)| \le 1$，且在大部分区间内严格小于1，所以迭代是收敛的。

----
